# 🎙️ Podcast App - Docker Development Environment

## 🚀 Quick Start
```bash
# From repository root
yarn install
yarn prisma generate

# Start development stack
cd infra/docker
docker-compose -f docker-compose.dev.yml up --build -d

# Check status
docker-compose ps

# View logs
docker-compose logs -f backend

# Stop all services
docker-compose down
```

## 🌍 Service URLs

### Development

| Service | URL / Host | Notes |
|---------|-----------|-------|
| Backend API | http://localhost:3300/api | Main NestJS backend |
| Swagger Docs | http://localhost:3300/api/docs | OpenAPI interface |
| Health Check | http://localhost:3300/api/health/readiness | Used by Docker healthcheck |
| Admin Panel | http://localhost:5175 | React + Vite |
| Mobile (Expo) | http://localhost:19005 | React Native Dev Server |
| MinIO Console | http://localhost:9101 | Access key: minioadmin |
| PostgreSQL | localhost:5435 | user: postgres, pass: postgres, db: podcast_app |
| Redis | localhost:6390 | default port 6379 mapped to 6390 |

### Production

| Service | URL / Host | Notes |
|---------|-----------|-------|
| Backend API | http://localhost:8090/api | Production port mapping |
| Admin Panel | http://localhost:8081 | Production admin panel |
| Mobile (Expo) | http://localhost:8091 | Production Expo Dev |
| PostgreSQL / Redis | Internal only | No external ports in prod |

## 🔐 Default Credentials

| Component | Credential |
|-----------|-----------|
| Admin Panel | admin@podcast.dev / changeme |
| PostgreSQL | postgres / postgres |
| MinIO | minioadmin / minioadmin |

## ⚙️ Port Mappings (Conflict-Free)

### Development

| Service | Host → Container |
|---------|------------------|
| Backend API | 3300 → 3300 |
| Admin Panel | 5175 → 5175 |
| Mobile (Expo) | 19005 → 19005 |
| PostgreSQL | 5435 → 5432 |
| Redis | 6390 → 6379 |
| MinIO API | 9100 → 9100 |
| MinIO Console | 9101 → 9101 |
| Elasticsearch (optional) | 9210 → 9210 |

### Production

| Service | Host → Container |
|---------|------------------|
| Backend API | 8090 → 3300 |
| Admin Panel | 8081 → 5175 |
| Mobile (Expo) | 8091 → 19005 |

> 🧩 Tüm portlar Synchron AI Hub ve Tourism AI ile çakışmayacak şekilde seçilmiştir.

## 🩺 Troubleshooting

### Port Conflicts
```bash
docker ps -a
lsof -i :3300
lsof -i :5435
```

"port already allocated" hatası varsa çakışan servisleri durdur.

### Database Connection

Eğer backend PostgreSQL'e bağlanamıyorsa:
```bash
docker-compose ps postgres
docker-compose logs postgres
psql -h localhost -p 5435 -U postgres -d podcast_app
```

### Prisma Errors

Şema değişikliklerinden sonra:
```bash
yarn prisma generate
yarn prisma migrate dev --name update_schema
docker-compose restart backend
```

### Container Build Fails
```bash
docker-compose down -v
docker system prune -af
docker-compose -f docker-compose.dev.yml up --build
```

## 🧱 Development Workflow

### Database Migrations
```bash
yarn workspace @podcast-app/backend prisma migrate dev --name add_new_feature
docker-compose restart backend
```

### Seed Database
```bash
docker-compose exec backend yarn prisma db seed
```

### Reset Database

⚠️ **Dikkat: Tüm veriler silinir**
```bash
docker-compose down -v
docker-compose up -d postgres
docker-compose exec backend yarn prisma migrate deploy
docker-compose exec backend yarn prisma db seed
```

## 🪵 Logs
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f backend
docker-compose logs -f postgres

# Last 100 lines
docker-compose logs --tail=100 backend
```

## 🔁 Rebuild Single Service
```bash
docker-compose up -d --build backend
```

## 📦 Additional Services

### MinIO (S3 Compatible)

- **Console:** http://localhost:9101
- **Access key:** minioadmin
- **Secret key:** minioadmin

### Elasticsearch (Optional)

- Enable in `docker-compose.dev.yml`
- **URL:** http://localhost:9210

## ☁️ Production Deployment
```bash
POSTGRES_PASSWORD=secure_password \
docker-compose -f docker-compose.prod.yml up -d
```

---

📝 **Last Updated:** October 2025
